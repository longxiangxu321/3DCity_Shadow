#!/bin/bash
echo "##################################################################"
echo "##################################################################"
echo "##################################################################"
echo "Preparing environment..."
echo "##################################################################"
echo "##################################################################"
echo "##################################################################"
echo " "

sudo apt update
sudo apt-get install build-essential libssl-dev

conda create -y --name shadow python=3.9
conda activate shadow
conda init
pip install -q pvlib numpy pytz pandas cjio==0.9.0 joblib triangle

mkdir -p build
cd build
cmake ..
make
cd ..

echo " "
echo "##################################################################"
echo "##################################################################"
echo "##################################################################"
echo "Start Execution..."
echo "##################################################################"
echo "##################################################################"
echo "##################################################################"
echo " "

echo " "
echo "##################################################################"
echo "Preparing 3D city models..."
echo "##################################################################"
echo " "
python3 src/prepare_json.py

echo " "
echo "##################################################################"
echo "Preparing solar positions..."
echo "##################################################################"
echo " "
python3 src/solar_pos.py

echo " "
echo "##################################################################"
echo "Running shadow calculation..."
echo "##################################################################"
echo " "
./build/shadow_calculation

echo " "
echo "##################################################################"
echo "Calculating solar irradiance..."
echo "##################################################################"
echo " "
python3 src/calculate_irradiance.py